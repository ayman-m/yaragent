# Observability Stack (Telemetry Plane)

This folder contains the initial telemetry plane scaffold:
- Grafana Alloy: log ingestion and forwarding
- Loki: log storage and query backend
- Grafana: dashboards and alerting UI

## Compose profile
These services are wired under the `observability` profile in `docker-compose.yml`.
All runtime config is generated by the one-shot `init` (bootstrap) container into a shared volume.

Run with:

```bash
docker compose --profile observability up -d --build
```

## Endpoints
- Loki API: `http://127.0.0.1:3100`
- Alloy ingest (Loki push API compatible): `http://127.0.0.1:9999/loki/api/v1/push`
- Grafana direct UI: `http://127.0.0.1:3001` (admin/admin by default)
- Grafana via app ingress (recommended for embed): `https://localhost/grafana`

## Notes
- This is a phase-1 scaffold to validate end-to-end telemetry flow.
- Grafana dashboards and alerting rules are provisioned from bootstrap-generated config.
- Alloy ingests agent telemetry via API and orchestrator container logs via docker socket.
- Loki retention is bootstrap-controlled via `INIT_OBSERVABILITY_LOKI_RETENTION_PERIOD` (default `168h`).
- Keep telemetry labels bounded: `service`, `tenant_id`, `agent_id`, `event_type`, `severity`, `env`.
